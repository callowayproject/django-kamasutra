{% load position_tags %}
{% get_applicable_positions content_type_id object_id as app_positions %}
{% get_content_positions content_type_id object_id as selected_positions %}
<script type="text/javascript">
    $(function() {
        var availableTags = [{% for position in app_positions %}"{{ position.name }}",{% endfor %}];
        $("#selector").autocomplete({
    		source: availableTags,
    		minLength: 2,
    		select: function(event, ui) {
    		    $.get("/position_management/add/"+ ui.item.value +"/{{ content_type_id }}/{{ object_id }}/");
                $('<li><span class="deletelink" id=pos_"'+ui.item.value+'">&nbsp;</span>'+ui.item.value+'</li>').appendTo("#position-admin-widget-items");
				$("#position-admin-widget-items li .deletelink").bind('click',function(){
					$.get($(this).attr('rel'));
					$(this).parent().remove();
				});
    		}
    	});
		$("#position-admin-widget-items li .deletelink").bind('click',function(){
			var id = $(this).attr('id');
			var pos = id.replace('pos_','');
			$.get('/position_management/remove/'+pos+'/{{ content_type_id }}/{{ object_id }}/');
			$(this).parent().remove();
		});
	});
</script>

<div id="position-admin-widget">
    <div id="position-admin-widget-input">
        <label for="selector">Positions: </label>
        <input id="selector" />
    </div>
    <ul id="position-admin-widget-items">
    	{% for position in selected_positions %}
    		<li><span class="deletelink" id="pos_{{ position.name}}">&nbsp;</span>{{ position.name }}</li>
    	{% endfor %}
    </ul>
</div>

    